"use client"

import { useState, useMemo } from "react"
import ExamplePhrase from "../../ExamplePhrase"
import { Search, X, Filter } from "lucide-react"

interface Order {
  id: string
  title: string
  category: string
  content: string
  tags: string[]
}

const AnnouncementsSection = () => {
  const [searchQuery, setSearchQuery] = useState("")
  const [selectedCategory, setSelectedCategory] = useState("all")

  // Массив всех приказов
  const orders: Order[] = [
    {
      id: "snyatie-vrio",
      title: "Снятие ВрИО срока (Заведующий)",
      category: "ВрИО",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о снятии ВрИО срока:

Сотрудник Kevin_Evil успешно проходит ВрИО срок и становиться на полноценную должность Заведующий ОЛД.`,
      tags: ["ВрИО", "снятие", "заведующий"]
    },
    {
      id: "snyatie-vrio-zam",
      title: "Снятие ВрИО срока (Заместитель)",
      category: "ВрИО",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о снятии ВрИО срока:

Сотрудник Sergey_Teslenko успешно проходит ВрИО срок и становится на полнаценную должность Заместитель главного врача.`,
      tags: ["ВрИО", "снятие", "заместитель"]
    },
    // Дополнительные взыскания
    {
      id: "vziskanie-28",
      title: "Выдача служебного взыскания 2.8 ПСГО",
      category: "Взыскания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о выдаче служебного взыскания:  

Сотрудник Daniel_Manarskiy, находясь в должности врач-хирург, получает взыскание в виде выговора и несёт ответственность по пункту 2.8 ПСГО (Сотрудник, получивший наказание по любому пункту ВПС, наказывается письменными взысканиями на усмотрение следящей администрации)
По жалобе: https://forum.gtaprovince.ru/topic/919005-mz-nonrp-artur_iralin/

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["взыскание", "выговор", "ПСГО", "ВПС"]
    },
    {
      id: "vziskanie-42-umz",
      title: "Выдача служебного взыскания 4.2 УМЗ",
      category: "Взыскания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о выдаче служебного взыскания:  

Сотрудник Daniel_Manarskiy, находясь в должности врач-хирург, получает взыскание в виде выговора и несёт ответственность по пункту 4.2 УМЗ (Запрещено отказывать в медицинской помощи гражданину Провинции.)
По жалобе: https://forum.gtaprovince.ru/topic/913359-mz-rp-nikolay_nellson/

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["взыскание", "выговор", "УМЗ", "отказ в помощи"]
    },
    {
      id: "vziskanie-310",
      title: "Выдача служебного взыскания 3.10 ПСГО",
      category: "Взыскания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о выдаче служебного взыскания:  

Сотрудник Daniel_Manarskiy, находясь в должности врач-хирург, получает взыскание в виде выговора и несёт ответственность по пункту 3.10 ПСГО (Нарушение правил чатов, сообщения не по теме в чат ДО).

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["взыскание", "выговор", "ПСГО", "чат"]
    },
    {
      id: "vziskanie-328",
      title: "Выдача служебного взыскания 3.28 ПСГО",
      category: "Взыскания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о выдаче служебного взыскания:  

Сотрудник Daniel_Manarskiy, находясь в должности врач-хирург, получает взыскание в виде выговора и несёт ответственность по пункту 3.28 ПСГО (Пребывание во фракции без наличия действующей медкарты).

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["взыскание", "выговор", "ПСГО", "медкарта"]
    },
    {
      id: "vziskanie-48",
      title: "Выдача служебного взыскания 4.8 ПСГО",
      category: "Взыскания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о выдаче служебного взыскания:  

Сотрудник Daniel_Manarskiy, находясь в должности врач-хирург, получает взыскание в виде выговора и несёт ответственность по пункту 4.8 ПСГО (Запрещено нецензурно выражаться).

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["взыскание", "выговор", "ПСГО", "мат"]
    },
    {
      id: "vziskanie-otchet",
      title: "Выдача служебного взыскания за несдачу отчета",
      category: "Взыскания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о выдаче служебного взыскания:  

Сотрудник Kayton_Romanov получает выговор за не сдачу отчета СС. 

Состояние: УП - {0/5}; П - (0/5); В - [1/3]`,
      tags: ["взыскание", "выговор", "отчет"]
    },
    // Дополнительные отпуска
    {
      id: "dosrochnoe-vozvrat",
      title: "Досрочное возвращение из отпуска",
      category: "Отпуска",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о возращении из отпуска:

Polter_Jameson - досрочно выходит из отпуска.`,
      tags: ["отпуск", "досрочное возвращение"]
    },
    // Дополнительные увольнения
    {
      id: "uvolnenie-psj-bez",
      title: "Увольнение по собственному желанию (без неустойки)",
      category: "Увольнения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ об увольнении:  

Сотрудник Sergey_Bobrov уволен из Областной Клинической Больницы города Мирный.
Причина: Собственное желание. Неустойка не требуется.
Должность при увольнении:(Врач-хирург).
Спасибо за проделанную медицинскую работу!  

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["увольнение", "собственное желание"]
    },
    {
      id: "uvolnenie-ochs-0111",
      title: "Увольнение по ОЧС 0.1.11 (Самолив)",
      category: "Увольнения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский] 

Приказ об увольнении:  

Сотрудник Daniel_Manarskiy находясь в должности (Врач-хирург), Областной Клинической Больницы города Мирный, с занесением в общий чёрный список для дальнейшего исключения возможности трудоустройства в организации сроком на 30 дней по пункту 0.1.11 ОЧС (Самолив из оф.бесед).

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["увольнение", "ОЧС", "самолив", "черный список"]
    },
    {
      id: "uvolnenie-ochs-013",
      title: "Увольнение по ОЧС 0.1.3 (Бан 10+ дней)",
      category: "Увольнения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский] 

Приказ об увольнении:  

Сотрудник Daniel_Manarskiy находясь в должности (Врач-хирург), покидает Областной Клинической Больницы города Мирный, с занесением в общий чёрный список для дальнейшего исключения возможности трудоустройства в организации сроком на 30 дней по пункту 0.1.3 ОЧС (Бан на 10 и более дней).

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["увольнение", "ОЧС", "бан", "черный список"]
    },
    {
      id: "uvolnenie-ochs-019",
      title: "Увольнение по ОЧС 0.1.9 (Неактив)",
      category: "Увольнения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский] 

Сотрудник Danill_Marcinkevich находясь в должности Интерн, покидает Областной Клинической Больницы города Мирный, с занесением в общий чёрный список для дальнейшего исключения возможности трудоустройства в организации сроком на 60 дней за нарушение пунка 0.1.9 ОЧС ( Продолжительный неактив без предупреждения).

Состояние: УП - {0/5}; П - (0/5); В - [0/3]`,
      tags: ["увольнение", "ОЧС", "неактив", "черный список"]
    },
    // Дополнительный приём
    {
      id: "priem-intern-closed",
      title: "Принятие в МУ на должность Интерна (закрытое)",
      category: "Приём",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский] 

Приказ о принятии в Медицинский Университет:  

Daniel_Manarskiy принят в Медицинский Университет ОКБ г. Мирный по результатам закрытого собеседования на должность Интерна. Желаем успешного продвижения в работе!  

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["приём", "интерн", "закрытое собеседование"]
    },
    {
      id: "priem-old",
      title: "Принятие в ОЛД (восстановление)",
      category: "Приём",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]  

Приказ о принятии в Отдел Лабораторной Диагностики:  

Daniel_Manarskiy восстанавливается в Отдел Лабораторной Диагностики ОКБ г. Мирный по результатам закрытого собеседования на должность врач-участковый. Рады видеть вас снова!  

Состояние: УП - {0/5}; П - (0/5); В - [3/3]`,
      tags: ["приём", "ОЛД", "восстановление"]
    },
    // Дополнительные повышения
    {
      id: "povyshenie-old",
      title: "Повышение классификации с переводом в ОЛД",
      category: "Повышения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский] 

Приказ о повышении классификации сотрудника:  

Сотрудник Daniel_Manarskiy повышается в классификации с Интерна до Лаборант в связи с успешной сдачей отчётности.
На основании поданного рапорта и в соответствии с кадровыми процедурами, сотрудник Daniel_Manarskiy переводится в Отдел Лабораторной Диагностики (далее ОЛД).
Продолжайте в том же духе!  

Состояние: УП - {0/5}; П - (0/5); В - [0/3]`,
      tags: ["повышение", "классификация", "перевод", "ОЛД"]
    },
    {
      id: "povyshenie-oth",
      title: "Повышение классификации с переводом в ОТХ",
      category: "Повышения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский] 

Приказ о повышении классификации сотрудника:  

Сотрудник Daniel_Manarskiy повышается в классификации с Интерна до Врач-Терапевт в связи с успешной сдачей отчётности.
На основании поданного рапорта и в соответствии с кадровыми процедурами, сотрудник Daniel_Manarskiy переводится в Отдел Терапии и Хирургии (далее - ОТХ).
Продолжайте в том же духе!  

Состояние: УП - {0/5}; П - (0/5); В - [0/3]`,
      tags: ["повышение", "классификация", "перевод", "ОТХ"]
    },
    // Дополнительные поощрения
    {
      id: "pooshchrenie-2",
      title: "Поощрение сотрудника (расширенное)",
      category: "Поощрения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

За проявленный высокий уровень профессиональной ответственности, активное участие в жизни Областной Клинической Больницы города Мирный, инициативность и качественное выполнение должностных обязанностей, сотруднику James_Cooper, занимающему должность Врач - хирург, выплачивается премия в размере 200.000.
Продолжайте в том же духе! 
Скрин перевода: https://imgur.com/a/AGfOkap`,
      tags: ["поощрение", "премия", "ответственность"]
    },
    // Дополнительные собрания
    {
      id: "sobranie-mp",
      title: "Собрание всего состава (Мероприятие)",
      category: "Собрания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Приказ о собрании всего состава:  

10.04.25 в 17:00 по МСК состоится сбор всего состава для проведения совместное мероприятие с ЦГБ-П. 
Ответственный за построение: Полтер Сокировский.
Явка на смене обязательна. Премии присутствуют.`,
      tags: ["собрание", "мероприятие", "премия"]
    },
    {
      id: "ezhenedelnoe-postroenie",
      title: "Еженедельное построение",
      category: "Собрания",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Завтра, 14.04.2025 в 21:00 пройдет еженедельное построение всего состава ОКБ г.Мирный. На нем подведём итоги уходящей недели, обсудим рабочие моменты. В конце построения, сотрудникам будут выплачены премии.`,
      tags: ["построение", "еженедельное", "премия"]
    },
    // СА приказы
    {
      id: "priem-sa-feldsher",
      title: "Принятие в СА на должность Фельдшера",
      category: "СА",
      content: `[Заместитель Главного Врача по Областной Клинической Больницы города Мирный | Начальник Санитарной Авиации | Полтер Сокировский]

На основании поданного рапорта и в соответствии с кадровыми процедурами, сотрудник Timur Goffman переводится в отдел Санитарной Авиации на должность Фельдшер Санитарной Авиации. С данного момента сотрудник имеет право оказывать высококвалифицированную медицинскую помощь и проводить технический осмотр ВСМП.

Желаем успехов, продуктивной работы и роста в новых обязанностях!`,
      tags: ["СА", "фельдшер", "санитарная авиация"]
    },
    {
      id: "priem-sa-pilot",
      title: "Принятие в СА на должность Пилота",
      category: "СА",
      content: `[Заместитель Главного Врача по Областной Клинической Больницы города Мирный | Начальник Санитарной Авиации | Полтер Сокировский]

На основании поданного рапорта и в соответствии с кадровыми процедурами, сотрудник Timur Goffman переводится в отдел Санитарной Авиации на должность Пилот Санитарной Авиации. С данного момента сотрудник имеет право пилотировать воздушное судно и способен оказывать высококвалифицированную медицинскую помощь.`,
      tags: ["СА", "пилот", "санитарная авиация"]
    },
    // Назначения
    {
      id: "naznachenie-nach-sa",
      title: "Постановление на должность Начальника СА",
      category: "Назначения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Сотрудник Ambassador_Bavarskiy назначен на должность "Начальник Санитарной Авиации".`,
      tags: ["назначение", "начальник", "СА"]
    },
    {
      id: "naznachenie-zam-sa",
      title: "Постановление на должность Зам. Начальника СА",
      category: "Назначения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Сотрудник Ibragim_Suhavey назначен на должность "Заместитель Начальника Санитарной Авиации".`,
      tags: ["назначение", "заместитель", "СА"]
    },
    {
      id: "naznachenie-ss",
      title: "Постановление новых сотрудников в СС",
      category: "Назначения",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Сотрудник Egor_Perepechin поставлен на должность Заведующий ОТХ по результатам обзвона.
Сотрудник Vladislav_Washington поставлен на должность Заведующий ВО по результатам обзвона.

ВрИО срок 7 дней.`,
      tags: ["назначение", "старший состав", "заведующий", "ВрИО"]
    },
    // Переводы отделы
    {
      id: "perevod-8-oth",
      title: "Перевод на другой отдел",
      category: "Переводы",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Учитывая успешное руководство отделом ММУ, сотрудник Kevin_Manarskiy переводится на должность заведующего отделом ОТХ.

Продолжайте в том же духе`,
      tags: ["перевод", "заведующий", "ОТХ"]
    },
    // Прочее
    {
      id: "forum-gotov",
      title: "Готовность форумного раздела",
      category: "Прочее",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Уважаемые сотрудники, коллеги! Форумный раздел ОКБ г. Мирный полностью обновлён, доработан и скорректирован. Если вы желаете ознакомиться, то просто перейдите ссылке:`,
      tags: ["форум", "обновление"]
    },
    {
      id: "smena-pasporta",
      title: "Смена паспортных данных",
      category: "Прочее",
      content: `[Главный Врач по Областной Клинической Больницы города Мирный | Полтер Сокировский]

Сотрудник Mara_Berzloy меняет свои паспортные данные на Mara_Bruja.`,
      tags: ["паспорт", "смена данных"]
    }
  ]

  // Получаем уникальные категории
  const categories = useMemo(() => {
    const cats = Array.from(new Set(orders.map(order => order.category)))
    return ["all", ...cats]
  }, [])

  // Фильтрация приказов
  const filteredOrders = useMemo(() => {
    let filtered = orders

    // Фильтр по категории
    if (selectedCategory !== "all") {
      filtered = filtered.filter(order => order.category === selectedCategory)
    }

    // Фильтр по поисковому запросу
    if (searchQuery.trim()) {
      const query = searchQuery.toLowerCase()
      filtered = filtered.filter(order =>
        order.title.toLowerCase().includes(query) ||
        order.content.toLowerCase().includes(query) ||
        order.tags.some(tag => tag.toLowerCase().includes(query))
      )
    }

    return filtered
  }, [searchQuery, selectedCategory])

  const clearSearch = () => setSearchQuery("")

  return (
    <>
      <div className="subsection">
        <h3>📋 Шаблоны приказов для Доски Объявлений</h3>

        <div className="note mb-6">
          <p><strong>📌 Примечание:</strong> Используйте поиск для быстрого нахождения нужного приказа. Все шаблоны адаптированы для МЗ.</p>
        </div>

        {/* Поисковая строка */}
        <div className="mb-6">
          <div className="relative mb-4">
            <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5" />
            <input
              type="text"
              placeholder="Поиск по названию, содержимому или тегам..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-12 py-3 rounded-lg border-2 border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all"
            />
            {searchQuery && (
              <button
                onClick={clearSearch}
                className="absolute right-4 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
                aria-label="Очистить поиск"
              >
                <X className="w-5 h-5" />
              </button>
            )}
          </div>

          {/* Фильтр по категориям */}
          <div className="flex items-center gap-2 flex-wrap">
            <Filter className="w-4 h-4 text-muted-foreground" />
            <span className="text-sm font-semibold text-foreground">Категория:</span>
            {categories.map(cat => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-3 py-1 rounded-full text-sm font-medium transition-all ${
                  selectedCategory === cat
                    ? "bg-primary text-primary-foreground"
                    : "bg-muted text-muted-foreground hover:bg-muted/80"
                }`}
              >
                {cat === "all" ? "Все" : cat}
              </button>
            ))}
          </div>

          {(searchQuery || selectedCategory !== "all") && (
            <p className="mt-3 text-sm text-muted-foreground">
              Найдено: <strong>{filteredOrders.length}</strong> {filteredOrders.length === 1 ? "приказ" : "приказов"}
            </p>
          )}
        </div>

        {/* Список приказов */}
        <div className="space-y-4">
          {filteredOrders.length > 0 ? (
            filteredOrders.map((order) => (
              <div
                key={order.id}
                className="bg-card/50 p-5 rounded-lg border-2 border-border hover:border-primary/50 transition-all"
              >
                <div className="flex items-start justify-between mb-3">
                  <h4 className="text-lg font-semibold text-foreground">{order.title}</h4>
                  <span className="px-3 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary">
                    {order.category}
                  </span>
                </div>
                <ExamplePhrase text={order.content} messageType="multiline" type="ss" />
                <div className="mt-3 flex flex-wrap gap-2">
                  {order.tags.map((tag, idx) => (
                    <span
                      key={idx}
                      className="px-2 py-1 rounded text-xs bg-muted text-muted-foreground"
                    >
                      #{tag}
                    </span>
                  ))}
                </div>
              </div>
            ))
          ) : (
            <div className="text-center py-12 text-muted-foreground">
              <p className="text-lg">По запросу "{searchQuery}" ничего не найдено</p>
              <p className="text-sm mt-2">Попробуйте изменить поисковый запрос или выбрать другую категорию</p>
            </div>
          )}
        </div>
      </div>
    </>
  )
}

export default AnnouncementsSection
