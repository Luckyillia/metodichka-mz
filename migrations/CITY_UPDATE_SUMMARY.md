# –ü—ñ–¥—Å—É–º–æ–∫ –æ–Ω–æ–≤–ª–µ–Ω—å: –í–∏–±—ñ—Ä –º—ñ—Å—Ç–∞ –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —Ç–∞ –∑–º—ñ–Ω–∞ –º—ñ—Å—Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–º—ñ–Ω–∏ (–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–æ –æ—Å–Ω–æ–≤–Ω–æ—ó –º—ñ–≥—Ä–∞—Ü—ñ—ó)

### ‚úÖ 1. **–§–æ—Ä–º–∞ –∑–∞–ø–∏—Ç—É –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é**
**–§–∞–π–ª**: `app/account-request/page.tsx`

**–©–æ –¥–æ–¥–∞–Ω–æ**:
- –ü–æ–ª–µ –≤–∏–±–æ—Ä—É –º—ñ—Å—Ç–∞ –≤ —Ñ–æ—Ä–º—ñ –∑–∞–ø–∏—Ç—É –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é
- –¢—Ä–∏ –æ–ø—Ü—ñ—ó: –¶–ì–ë-–ù, –¶–ì–ë-–ü, –û–ö–ë-–ú
- –ó–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: CGB-N
- –ü—ñ–¥–∫–∞–∑–∫–∞ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–æ –≤–∏–±—ñ—Ä –º—ñ—Å—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–µ–ø–µ—Ä –º–æ–∂—É—Ç—å –≤–∏–±—Ä–∞—Ç–∏ –º—ñ—Å—Ç–æ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–ø–∏—Ç—É –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç.

---

### ‚úÖ 2. **API –∑–∞–ø–∏—Ç—É –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é**
**–§–∞–π–ª**: `app/api/account-request/route.ts`

**–©–æ –¥–æ–¥–∞–Ω–æ**:
- –û–±—Ä–æ–±–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `city` –∑ –∑–∞–ø–∏—Ç—É
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –º—ñ—Å—Ç–∞ (—Ç—ñ–ª—å–∫–∏ CGB-N, CGB-P, OKB-M)
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º—ñ—Å—Ç–∞ –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–ø–∏—Ç—É
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –º—ñ—Å—Ç–∞ –≤ action_logs

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: API –∫–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–æ–±–ª—è—î —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –º—ñ—Å—Ç–æ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–ø–∏—Ç—É.

---

### ‚úÖ 3. **–ó–º—ñ–Ω–∞ –º—ñ—Å—Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏**

#### 3.1. **AuthService**
**–§–∞–π–ª**: `lib/auth/auth-service.ts`

**–î–æ–¥–∞–Ω–æ –º–µ—Ç–æ–¥**:
```typescript
static async updateUserCity(userId: string, city: string): Promise<User | null>
```

#### 3.2. **API –¥–ª—è –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞**
**–§–∞–π–ª**: `app/api/users/route.ts`

**–î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–∫—É action**: `change_city`

**–õ–æ–≥—ñ–∫–∞**:
- –¢—ñ–ª—å–∫–∏ root —Ç–∞ admin –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –º—ñ—Å—Ç–æ
- –ù–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –º—ñ—Å—Ç–æ root –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –º—ñ—Å—Ç–∞
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–∏ –≤ action_logs

#### 3.3. **UI –¥–ª—è –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞**
**–§–∞–π–ª**: `app/components/Manual/sections/admin/UserManagementSection.tsx`

**–©–æ –¥–æ–¥–∞–Ω–æ**:
- –°—Ç–∞–Ω `showCityModal` —Ç–∞ `changingCityUser`
- –§—É–Ω–∫—Ü—ñ—è `openCityModal()` - –≤—ñ–¥–∫—Ä–∏–≤–∞—î –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
- –§—É–Ω–∫—Ü—ñ—è `handleChangeCity()` - –æ–±—Ä–æ–±–ª—è—î –∑–º—ñ–Ω—É –º—ñ—Å—Ç–∞
- –ö–Ω–æ–ø–∫–∞ –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞ (—ñ–∫–æ–Ω–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó) –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ —Ñ–æ—Ä–º–æ—é –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞

**–ö–Ω–æ–ø–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è**:
- –¢—ñ–ª—å–∫–∏ –¥–ª—è root —Ç–∞ admin
- –¢—ñ–ª—å–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ù–µ –¥–ª—è root –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ù–µ –¥–ª—è —Å–∞–º–æ–≥–æ —Å–µ–±–µ

---

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É

### –ó–º—ñ–Ω–∞ –º—ñ—Å—Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
- ‚úÖ **Root**: –ú–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –º—ñ—Å—Ç–æ –±—É–¥—å-—è–∫–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É (–∫—Ä—ñ–º root)
- ‚úÖ **Admin**: –ú–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –º—ñ—Å—Ç–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º (–∫—Ä—ñ–º admin —Ç–∞ root)
- ‚ùå **Leader**: –ù–µ –º–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –º—ñ—Å—Ç–æ
- ‚ùå **CC/User**: –ù–µ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –º—ñ—Å—Ç–æ

### –í–∏–±—ñ—Ä –º—ñ—Å—Ç–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ:
- ‚úÖ **–ü—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó (–∑–∞–ø–∏—Ç)**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∞–º –≤–∏–±–∏—Ä–∞—î –º—ñ—Å—Ç–æ
- ‚úÖ **Root**: –ú–æ–∂–µ –≤–∏–±—Ä–∞—Ç–∏ –±—É–¥—å-—è–∫–µ –º—ñ—Å—Ç–æ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- ‚úÖ **Admin**: –ú–æ–∂–µ –≤–∏–±—Ä–∞—Ç–∏ –±—É–¥—å-—è–∫–µ –º—ñ—Å—Ç–æ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- ‚ö†Ô∏è **Leader**: –°—Ç–≤–æ—Ä—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ–≥–æ –º—ñ—Å—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)

---

## –í—ñ–∑—É–∞–ª—å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏

### –Ü–∫–æ–Ω–∫–∞ –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞
```
üó∫Ô∏è (–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è) - —Å–∏–Ω—å–æ–≥–æ –∫–æ–ª—å–æ—Ä—É
```

### –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥: [–Ü–≥—Ä–æ–≤–∏–π –Ω—ñ–∫]"
- –ü–æ–ª–µ "–¢–µ–∫—É—â–∏–π –≥–æ—Ä–æ–¥" (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è)
- –°–µ–ª–µ–∫—Ç–æ—Ä "–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥" –∑ —Ç—Ä—å–æ–º–∞ –æ–ø—Ü—ñ—è–º–∏
- –ö–Ω–æ–ø–∫–∏: "–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥" (—Å–∏–Ω—è) —Ç–∞ "–û—Ç–º–µ–Ω–∞"

---

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–í—Å—ñ –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞ –ª–æ–≥—É—é—Ç—å—Å—è –≤ `action_logs`:
- **action_type**: `update`
- **target_type**: `user`
- **details**: "–ì–æ—Ä–æ–¥ –∏–∑–º–µ–Ω–µ–Ω —Å '[—Å—Ç–∞—Ä–µ –º—ñ—Å—Ç–æ]' –Ω–∞ '[–Ω–æ–≤–µ –º—ñ—Å—Ç–æ]'"
- **previous_state**: `{ city: "—Å—Ç–∞—Ä–µ_–º—ñ—Å—Ç–æ" }`
- **new_state**: `{ city: "–Ω–æ–≤–µ_–º—ñ—Å—Ç–æ" }`
- **metadata**: `{ changed_by: "—ñ–≥—Ä–æ–≤–∏–π_–Ω—ñ–∫_–∞–¥–º—ñ–Ω–∞", username: "–ª–æ–≥—ñ–Ω_–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" }`

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–µ:

1. **–§–æ—Ä–º–∞ –∑–∞–ø–∏—Ç—É –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é**:
   - [ ] –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä –º—ñ—Å—Ç–∞
   - [ ] –ú–æ–∂–Ω–∞ –≤–∏–±—Ä–∞—Ç–∏ –∫–æ–∂–Ω–µ –∑ —Ç—Ä—å–æ—Ö –º—ñ—Å—Ç
   - [ ] –ó–∞–ø–∏—Ç —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑ –≤–∏–±—Ä–∞–Ω–∏–º –º—ñ—Å—Ç–æ–º

2. **–ó–º—ñ–Ω–∞ –º—ñ—Å—Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º**:
   - [ ] Root –±–∞—á–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞ –¥–ª—è –≤—Å—ñ—Ö (–∫—Ä—ñ–º root)
   - [ ] Admin –±–∞—á–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞ –¥–ª—è user/cc/ld
   - [ ] Leader –ù–ï –±–∞—á–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞
   - [ ] –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
   - [ ] –ú—ñ—Å—Ç–æ –∑–º—ñ–Ω—é—î—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–æ
   - [ ] –ó–º—ñ–Ω–∞ –ª–æ–≥—É—î—Ç—å—Å—è –≤ action_logs

3. **–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º—ñ—Å—Ç–∞**:
   - [ ] –ú—ñ—Å—Ç–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –≤ —Ö–µ–¥–µ—Ä—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: "–õ—ñ–¥–µ—Ä –¶–ì–ë-–ù")
   - [ ] –ú—ñ—Å—Ç–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
   - [ ] –ú—ñ—Å—Ç–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ –∑–º—ñ–Ω–∏ –º—ñ—Å—Ç–∞

4. **–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –¥–ª—è –ª—ñ–¥–µ—Ä—ñ–≤**:
   - [ ] –õ—ñ–¥–µ—Ä –±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å–≤–æ–≥–æ –º—ñ—Å—Ç–∞
   - [ ] –õ—ñ–¥–µ—Ä –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ–≥–æ –º—ñ—Å—Ç–∞

---

## –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –≤–∏–±–æ—Ä–æ–º –º—ñ—Å—Ç–∞ (Root/Admin):
1. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
2. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É
3. –í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ –∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ (—è–∫—â–æ –≤–∏ root –∞–±–æ admin)
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

### –ó–º—ñ–Ω–∞ –º—ñ—Å—Ç–∞ —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (Root/Admin):
1. –ó–Ω–∞–π–¥—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Ç–∞–±–ª–∏—Ü—ñ
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —ñ–∫–æ–Ω–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó (üó∫Ô∏è) –±—ñ–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
3. –í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–µ –º—ñ—Å—Ç–æ
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥"

### –ó–∞–ø–∏—Ç –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –∑ –≤–∏–±–æ—Ä–æ–º –º—ñ—Å—Ç–∞:
1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ `/account-request`
2. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É
3. –í–∏–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å
4. –í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ, –¥–µ —Ö–æ—á–µ—Ç–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
5. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å"

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º—ñ—Å—Ç

| –ö–æ–¥ | –ü–æ–≤–Ω–∞ –Ω–∞–∑–≤–∞ | –û–ø–∏—Å |
|-----|-------------|------|
| CGB-N | –¶–ì–ë-–ù | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ì–æ—Ä–æ–¥—Å–∫–∞—è –ë–æ–ª—å–Ω–∏—Ü–∞ - –ù–æ–≤—ã–π |
| CGB-P | –¶–ì–ë-–ü | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ì–æ—Ä–æ–¥—Å–∫–∞—è –ë–æ–ª—å–Ω–∏—Ü–∞ - –ü–∞–ª–µ—Ç–æ |
| OKB-M | –û–ö–ë-–ú | –û–∫—Ä—É–∂–Ω–∞—è –ö–ª–∏–Ω–∏—á–µ—Å–∫–∞—è –ë–æ–ª—å–Ω–∏—Ü–∞ - –ú–∏—Ä–∞–ø–∞—Ä–∫ |

---

## –í–∞–∂–ª–∏–≤–æ!

‚ö†Ô∏è **–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö** `004_add_city_column.sql` –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ü–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π!

–ë–µ–∑ –º—ñ–≥—Ä–∞—Ü—ñ—ó –∫–æ–ª–æ–Ω–∫–∞ `city` –Ω–µ –±—É–¥–µ —ñ—Å–Ω—É–≤–∞—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ `users`, —ñ –≤—Å—ñ –∑–∞–ø–∏—Ç–∏ –±—É–¥—É—Ç—å –ø–∞–¥–∞—Ç–∏ –∑ –ø–æ–º–∏–ª–∫–æ—é.
