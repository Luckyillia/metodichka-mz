-- Migration: Promotion system (single table + full seed)

CREATE TABLE IF NOT EXISTS public.promotion_section_info (
    section_key text PRIMARY KEY,
    name text NOT NULL,
    subtitle text NOT NULL,
    color text NOT NULL,
    sort_order integer NOT NULL DEFAULT 0
);

CREATE TABLE IF NOT EXISTS public.promotion_system_items (
    id bigserial PRIMARY KEY,

    category text NOT NULL CHECK (category IN ('promotion', 'reprimand')),

    section_key text NOT NULL,
    task_sort integer NOT NULL DEFAULT 0,
    task text NOT NULL,
    max text NOT NULL,
    points text NOT NULL,

    created_at timestamptz NOT NULL DEFAULT now(),
    updated_at timestamptz NOT NULL DEFAULT now(),
    updated_by text NULL
);

CREATE INDEX IF NOT EXISTS idx_promotion_system_items_category_section
    ON public.promotion_system_items (category, section_key, task_sort);

CREATE INDEX IF NOT EXISTS idx_promotion_system_items_section_key
    ON public.promotion_system_items (section_key);

CREATE INDEX IF NOT EXISTS idx_promotion_section_info_sort
    ON public.promotion_section_info (sort_order);

-- Full seed from current PromotionSystem.tsx
-- Note: Uses DELETE to avoid duplicates when re-applying manually
DELETE FROM public.promotion_system_items;
DELETE FROM public.promotion_section_info;

INSERT INTO public.promotion_section_info (section_key, name, subtitle, color, sort_order) VALUES
('pmu','ПМУ','Интерн - Фельдшер 40 баллов | Фельдшер - Лаборант 60 баллов','bg-pink-500',1),
('old','ОЛД','Лаборант - Врач-стажер 85 баллов | Врач-стажер - Врач-участковый 120 баллов | Врач-участковый - Врач-терапевт 155 баллов','bg-destructive',2),
('oth','ОТХ','Врач-терапевт - Врач-хирург 190 баллов','bg-orange-600',3),
('rep_1_7','Система отработки выговоров для 1-7 ранга','Интерн 35 баллов | Фельдшер 55 баллов | Лаборант 75 баллов | Врач-стажер 100 баллов | Врач-участковый 135 баллов | Врач-терапевт 160 баллов | Врач-хирург 200 баллов','bg-yellow-600',4),
('rep_lead','Система отработки выговоров для Руководящего состава','Заведующий отделением 240 баллов | Заместитель Главного Врача 280 баллов | Главный Заместитель Главного Врача 300 баллов','bg-yellow-600',5);

INSERT INTO public.promotion_system_items (
    category,
    section_key,
    task_sort,
    task,
    max,
    points
) VALUES
-- Promotions: ПМУ
('promotion','pmu',1,'Лечение пациентов в больнице','10','1'),
('promotion','pmu',2,'Лечение пациентов в АСМП','10','2'),
('promotion','pmu',3,'Выполнение RP задания','5','2'),
('promotion','pmu',4,'Прослушивание лекции','3','5'),
('promotion','pmu',5,'Присутствие на тренировке','3','5'),
('promotion','pmu',6,'Присутствие на МП','3','10'),
('promotion','pmu',7,'Присутствие на МП с другой фракцией','3','15'),
('promotion','pmu',8,'Присутствие на МП от Следящих','Безгранично','25'),
('promotion','pmu',9,'Обработка вызова от других гос. структур в качестве напарника','3','5'),
('promotion','pmu',10,'Обработка вызова в качестве напарника','5','3'),
('promotion','pmu',11,'Патруль города 30 минут в качестве напарника','3','10'),
('promotion','pmu',12,'Любой пост 30 минут в качестве напарника','3','10'),
('promotion','pmu',13,'Пост "регистратура" 15 минут','2','5'),

-- Promotions: ОТХ
('promotion','oth',1,'Лечение пациентов в больнице','10','1'),
('promotion','oth',2,'Лечение пациентов в АСМП','10','2'),
('promotion','oth',3,'Выполнение RP задания','3','2'),
('promotion','oth',4,'Прослушивание лекции','3','5'),
('promotion','oth',5,'Присутствие на тренировке','3','5'),
('promotion','oth',6,'Присутствие на МП','3','10'),
('promotion','oth',7,'Присутствие на МП с другой фракцией','3','15'),
('promotion','oth',8,'Присутствие на МП от Следящих','Безгранично','25'),
('promotion','oth',9,'Обработка вызова в качестве напарника','5','3'),
('promotion','oth',10,'Патруль города 30 минут в качестве напарника','3','10'),
('promotion','oth',11,'Любой пост 30 минут в качестве напарника','3','10'),
('promotion','oth',12,'Пост "регистратура" 15 минут','2','5'),
('promotion','oth',13,'Патруль города 30 минут','3','15'),
('promotion','oth',14,'Любой пост 30 минут','3','15'),
('promotion','oth',15,'Обработка вызова','5','5'),
('promotion','oth',16,'Помощь в проведении мед.комиссии в рамках призыва на срочную службу','Безгранично','2 (за каждого срочника)'),
('promotion','oth',17,'Выдача мед. карты гражданским или сотрудникам гос. Организаций','10','5'),
('promotion','oth',18,'Обработка вызова от других гос. структур в качестве напарника','3','5'),
('promotion','oth',19,'Обработка вызова от других гос. структур','3','7'),
('promotion','oth',20,'Помощь в проведении собеседования','Безгранично','20'),
('promotion','oth',21,'Помощь в поставке медикаментов (Для ГВ-МУ)','2','10'),
('promotion','oth',22,'Пост на ВЧ 60 минут (Для ГВ-МУ)','2','20'),
('promotion','oth',23,'Проверка алкотестером гражданских по требованию сотрудников МВД','5','5'),

-- Promotions: ОЛД
('promotion','old',1,'Лечение пациентов в больнице','10','1'),
('promotion','old',2,'Лечение пациентов в АСМП','10','2'),
('promotion','old',3,'Выполнение RP задания','3','2'),
('promotion','old',4,'Прослушивание лекции','3','5'),
('promotion','old',5,'Присутствие на тренировке','3','5'),
('promotion','old',6,'Присутствие на МП','3','10'),
('promotion','old',7,'Присутствие на МП с другой фракцией','3','15'),
('promotion','old',8,'Присутствие на МП от Следящих','Безгранично','25'),
('promotion','old',9,'Обработка вызова в качестве напарника','5','3'),
('promotion','old',10,'Патруль города 30 минут в качестве напарника','3','10'),
('promotion','old',11,'Любой пост 30 минут в качестве напарника','3','10'),
('promotion','old',12,'Пост "регистратура" 15 минут','2','5'),
('promotion','old',13,'Патруль города 30 минут','3','15'),
('promotion','old',14,'Любой пост 30 минут','3','15'),
('promotion','old',15,'Обработка вызова','5','5'),
('promotion','old',16,'Помощь в проведении мед.комиссии в рамках призыва на срочную службу','Безгранично','2 (за каждого срочника)'),
('promotion','old',17,'Выдача мед. карты гражданским или сотрудникам гос. Организаций','10','5'),
('promotion','old',18,'Обработка вызова от других гос. структур в качестве напарника','3','5'),
('promotion','old',19,'Обработка вызова от других гос. структур','3','7'),
('promotion','old',20,'Помощь в проведении собеседования','Безгранично','20'),
('promotion','old',21,'Помощь в поставке медикаментов (только для ГВ-МУ)','2','10'),
('promotion','old',22,'Пост на ВЧ 60 минут (только для ГВ-МУ)','2','20'),
('promotion','old',23,'Проверка алкотестером гражданских по требованию сотрудников МВД','5','5'),

-- Reprimands: 1-7
('reprimand','rep_1_7',1,'Лечение пациентов в больнице','25','1'),
('reprimand','rep_1_7',2,'Лечение пациентов в АСМП','25','2'),
('reprimand','rep_1_7',3,'Выполнение RP задания','5','2'),
('reprimand','rep_1_7',4,'Прослушивание лекции','10 (не больше 3 в день)','5'),
('reprimand','rep_1_7',5,'Присутствие на тренировке','10 (не больше 3 в день)','5'),
('reprimand','rep_1_7',6,'Присутствие на МП','5','10'),
('reprimand','rep_1_7',7,'Присутствие на МП с другой фракцией','5','20'),
('reprimand','rep_1_7',8,'Присутствие на МП от Следящих','Безгранично','25'),
('reprimand','rep_1_7',9,'Обработка вызова в качестве напарника','5','3'),
('reprimand','rep_1_7',10,'Патруль города 30 минут в качестве напарника','5','10'),
('reprimand','rep_1_7',11,'Любой пост 30 минут в качестве напарника','5','10'),
('reprimand','rep_1_7',12,'Пост "регистратура" 15 минут','2','5'),
('reprimand','rep_1_7',13,'Патруль города 30 минут','3','15'),
('reprimand','rep_1_7',14,'Любой пост 30 минут','3','15'),
('reprimand','rep_1_7',15,'Обработка вызова','5','5'),
('reprimand','rep_1_7',16,'Помощь в проведении мед.комиссии в рамках призыва на срочную службу','Безгранично','2 (за каждого срочника)'),
('reprimand','rep_1_7',17,'Выдача мед. карты гражданским или сотрудникам гос. Организаций','10','5'),
('reprimand','rep_1_7',18,'Обработка вызова от других гос. структур в качестве напарника','3','5'),
('reprimand','rep_1_7',19,'Обработка вызова от других гос. структур','3','7'),
('reprimand','rep_1_7',20,'Помощь в проведении собеседования','Безгранично','30'),
('reprimand','rep_1_7',21,'Помощь в поставке медикаментов (Для ГВ-МУ)','4','10'),
('reprimand','rep_1_7',22,'Пост на ВЧ 60 минут (Для ГВ-МУ)','3','20'),
('reprimand','rep_1_7',23,'Проверка алкотестером гражданских по требованию сотрудников МВД','5','5'),

-- Reprimands: Leadership
('reprimand','rep_lead',1,'Лечение пациентов в больнице','15','1'),
('reprimand','rep_lead',2,'Лечение пациентов в АСМП','15','2'),
('reprimand','rep_lead',3,'Проведение лекции','10 (не больше 3 в день)','5'),
('reprimand','rep_lead',4,'Проведение тренировки','10 (не больше 3 в день)','5'),
('reprimand','rep_lead',5,'Проведение МП','5 (не больше 2 в день)','15'),
('reprimand','rep_lead',6,'Проведение МП с другой фракцией','5 (не больше 2 в день)','20'),
('reprimand','rep_lead',7,'Проведение собеседования по ЭЗ','Безгранично','20'),
('reprimand','rep_lead',8,'Проведение открытого собеседования','Безгранично','45'),
('reprimand','rep_lead',9,'Присутствие на МП','3','10'),
('reprimand','rep_lead',10,'Присутствие на МП с другой фракцией','3','15'),
('reprimand','rep_lead',11,'Присутствие на МП от Следящих','Безгранично','25'),
('reprimand','rep_lead',12,'Обработка вызова в качестве напарника','5','3'),
('reprimand','rep_lead',13,'Патруль города 30 минут в качестве напарника','3','10'),
('reprimand','rep_lead',14,'Любой пост 30 минут в качестве напарника','3','10'),
('reprimand','rep_lead',15,'Патруль города 30 минут','3','15'),
('reprimand','rep_lead',16,'Любой пост 30 минут','3','15'),
('reprimand','rep_lead',17,'Обработка вызова','5','5'),
('reprimand','rep_lead',18,'Помощь в проведении мед.комиссии в рамках призыва на срочную службу','Безгранично','2 (за каждого срочника)'),
('reprimand','rep_lead',19,'Выдача мед. карты гражданским или сотрудникам гос. Организаций','10','5'),
('reprimand','rep_lead',20,'Обработка вызова от других гос. структур в качестве напарника','3','5'),
('reprimand','rep_lead',21,'Обработка вызова от других гос. структур','3','7'),
('reprimand','rep_lead',22,'Помощь в проведении собеседования','Безгранично','20'),
('reprimand','rep_lead',23,'Помощь в поставке медикаментов (Для ГВ-МУ)','2','10'),
('reprimand','rep_lead',24,'Пост на ВЧ 60 минут (Для ГВ-МУ)','2','20'),
('reprimand','rep_lead',25,'Проверка алкотестером гражданских по требованию сотрудников МВД','5','5');
