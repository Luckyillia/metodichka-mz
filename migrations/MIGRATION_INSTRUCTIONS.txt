ИНСТРУКЦИЯ ПО ПРИМЕНЕНИЮ МИГРАЦИЙ
====================================

1. ПРИМЕНИТЬ МИГРАЦИЮ (Supabase SQL Editor):
   - Скопировать содержимое APPLY_ALL_MIGRATIONS.sql
   - Вставить в SQL Editor
   - Нажать Run

2. ПРОВЕРИТЬ РЕЗУЛЬТАТ:
   - Должна быть колонка 'status' (text)
   - Должна быть колонка 'ip_address' (text)
   - Все существующие пользователи должны иметь status='active' и ip_address='1.1.1.1'

3. ПОСЛЕ ПРОВЕРКИ (опционально):
   - Раскомментировать STEP 3 в APPLY_ALL_MIGRATIONS.sql
   - Запустить снова для удаления колонки 'active'

НОВАЯ ФУНКЦИОНАЛЬНОСТЬ:
========================

1. ВЫБОР РОЛИ В ФОРМЕ ЗАПРОСА:
   - Пользователь может выбрать: user, cc, ld
   - Администратор не доступен для выбора

2. ЗАЩИТА ОТ ПОВТОРНЫХ ЗАПРОСОВ:
   - Проверка по IP адресу
   - Если с IP уже есть запрос - блокируется
   - Если с IP уже есть активный аккаунт - блокируется
   - Специальный IP 1.1.1.1 для пользователей, созданных админом

3. IP АДРЕСА:
   - Запросы от пользователей - реальный IP
   - Создание админом - 1.1.1.1
   - Используется для защиты от дублей

ПРОВЕРКА:
=========

-- Посмотреть все статусы
SELECT status, COUNT(*) FROM users GROUP BY status;

-- Посмотреть IP адреса
SELECT ip_address, COUNT(*) FROM users GROUP BY ip_address;

-- Найти запросы
SELECT username, game_nick, role, status, ip_address, created_at 
FROM users 
WHERE status = 'request';
